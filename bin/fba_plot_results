#!/usr/bin/env python
"""
Create fiber assignment plots.
"""
import os

import argparse

from fiberassign.vis import plot_tiles


def main():
    parser = argparse.ArgumentParser()

    parser.add_argument("--dir", type=str, required=True, default=None,
                        help="Directory containing fiberassign outputs.")

    parser.add_argument("--prefix", type=str, required=False,
                        default="fiberassign",
                        help="Prefix of each file (before the _<tile>.fits).")

    parser.add_argument("--tiles", type=str, required=False, default=None,
                        help="Comma-separated list of tiles to plot "
                        "(default is all tiles)")

    parser.add_argument("--petals", type=str, required=False, default=None,
                        help="Comma-separated list of petals to plot "
                        "(default is all petals)")

    parser.add_argument("--old", required=False, default=False,
                        action="store_true",
                        help="Files are old format.")

    args = parser.parse_args()

    # Check directory
    if not os.path.isdir(args.dir):
        raise RuntimeError("Results directory {} does not exist"
                           .format(args.dir))

    tiles = None
    if args.tiles is not None:
        tiles = [int(x) for x in args.tiles.split(",")]

    petals = None
    if args.petals is not None:
        petals = [int(x) for x in args.petals.split(",")]

    plot_tiles(resultdir=args.dir, result_prefix=args.prefix, tiles=tiles,
               petals=petals, old=args.old)

    return


if __name__ == "__main__":
    main()
